# SIMD指令

SIMD指的是单指令多数据流技术，是CPU多媒体及高性能计算领域的一项重要技术。他可以使CPU同时计算多个数据，从而极大的提高计算效率。在现代计算机中，SIMD一般是通过向量处理器或多媒体指令集来实现的。向量处理器是一种专门用来执行向量操作的特殊处理器，而多媒体指令集则是在通用CPU指令集的基础上添加了一些用于多媒体处理的指令。在软件开发中，可以通过编写支持SIMD指令集的代码来利用这项技术，从而提高程序的运行速度。常见的支持SIMD指令集的语言包括C，C++，java和python等

简单来讲：SIMD中文翻译过来是单指令多数据流，可以使用一条指令同时完成多个数据的运算操作。相对的，最传统的指令架构是SISD就是单指令单数据流，每条指令只能对一个数据执行操作

SIMD的优点：我们普通应用场景中有很多情况下需要对大量数据执行相同的操作，例如图片处理，视频特效等，在这种时候使用SIMD指令能取得很大的性能提升，例如SSE指令，支持每次对4个FP32进行操作，那么我们常用的vector4向量加减乘除，皆可以使用一个指令完成，效率提高

SIMD的缺点：为SIMD优化的程序在处理分支指令时性能不佳，因为分支指令本质上是一部分数据流根据条件去执行不同的指令，当多个数据需要运行的分支不同时，需要运行两次程序遍历来完成所有数据流的操作。此外，不是所有情况下都需要很高的并行度

总结：

现代编译器已经能为我们自动做很多优化工作，比如上面提到的循环展开，以及自动向量化，不过这不代表我们学习手写SIMD代码就没有意义了。在向量、矩阵运算等基础库函数中，每个函数通常代码量不大，复杂度不高，但编译器并不能保证会给你优化好，手撸SIMD还是很有必要的。更重要的是，我们能在学习的过程中去接触更底层的一些东西（指令集，内存架构，汇编等），进而提升对整体的编程实力。

SIMD指令是分数据类型，分平台的，使用的时候，需要注意数据类型和平台限制

我们可以通过查看当前CPU是否支持SIMD指令

cat /proc/cpuinfo

查看flags的输出

![https://cdn.nlark.com/yuque/0/2024/png/23087967/1717309557094-42f4197e-510d-42a1-8d76-ef304f007018.png](https://cdn.nlark.com/yuque/0/2024/png/23087967/1717309557094-42f4197e-510d-42a1-8d76-ef304f007018.png)