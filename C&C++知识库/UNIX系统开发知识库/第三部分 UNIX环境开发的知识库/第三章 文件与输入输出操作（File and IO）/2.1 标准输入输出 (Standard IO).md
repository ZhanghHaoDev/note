# 标准输入输出 (Standard IO)

## 1， 标准输入/输出简介

1. 代码仓库：unix_stu/unix_stu/unix_io_stu
2. 测试仓库：unix_stu/test/unix_io_stu
3. 输出常用的就是 printf ，perror 表示错误输出，fprintf 表示日志输出并且这个可以输出到文件
4. 按照惯例，每当运行一个新程序的时候，所有的shell都为其打开3个文件描述符，即标准输入，标准输出，标准错误。如果没有特殊处理，则3个描述符都会链接向终端
5. 函数返回的错误：使用系统函数出错时会设置全局变量`errno`。`errno`是一个宏，它对应于一个线程局部存储的变量，因此在使用多线程程序中也是安全的
6. 本质上，标准输入/输出是文件IO的一部分，因为值unix上一切皆文件，标准输入、标准输出和标准错误实际上是特殊的文件描述符，它们分别对应于文件描述符 0、1 和 2。

## 2. 标准输入/输出 (Standard Input/Output) 函数接口

1. printf 格式化输出
+ 函数功能：格式化输出字符串
+ 函数原型：
    ```c
    #include <stdio.h>
    int printf(const char *format, ...);
    ```
+ 函数参数：const char *format：格式控制字符串，包含文本和格式说明符。...：可变参数列表，包含要输出的值。
+ 函数返回值：返回成功写入的字符数（不包括终止的空字符）。错误返回值负数
+ 这是一个带缓冲区的输出流。缓冲区用于暂存数据，直到缓冲区满或遇到换行符时才会实际输出到终端。

2. perror 输出错误信息
+ 函数功能：输出错误信息到标准错误流（stderr）
+ 函数原型：
    ```c
    #include <stdio.h>
    void perror(const char *str);
    ```
+ 函数参数：const char *str：用户自定义的错误信息字符串。如果 `str` 不是 `NULL`，则先输出 `str`，然后输出一个冒号和空格，再输出错误信息。
+ 函数返回值：无返回值
+ 这是一个无缓冲区的输出流。数据会立即输出到终端，不会被暂存。

3. fprintf 格式化输出到指定文件流
+ 函数功能：格式化输出到指定文件流
+ 函数原型：
    ```c
    #include <stdio.h>
    int fprintf(FILE *stream, const char *format, ...);
    ```
+ 函数参数：FILE *stream：文件流指针，指定输出目标文件。
        const char *format：格式控制字符串，包含文本和格式说明符。
        ...：可变参数列表，包含要输出的值。
+ 函数返回值：返回成功写入的字符数（不包括终止的空字符）。失败返回负数
+ 很多的库喜欢使用 fprintf 而不是 printf 原因可能是下面
  + 更加灵活：printf 只能输出到控制台，fprintf 可以输出到文件流
  + 错误处理：fprintf 可以将错误输出输出到biaoz错误流（stderr），而不是输出流（stdout）
  + 日志处理：fprintf 可以将日志写入日志文件
  + 多线程安全：使用 fprintf 可以将输出定向到不同的文件流，从而避免多个线程同时写入标准输出导致的混乱。
  + 重定向输出：在某些情况下，程序可能需要将输出重定向到不同的目标，例如文件、网络连接等。使用 fprintf 可以更容易地实现这一点。

4. sprintf：格式化输出到字符串。
+ 函数功能：格式化输出到字符串。
+ 函数原型：
    ```c
    #include <stdio.h>
    int sprintf(char *str, const char *format, ...);
    ```
+ 函数参数：
  + char *str：目标字符串缓冲区。
  + const char *format：格式控制字符串，包含文本和格式说明符。
  + ...：可变参数列表，包含要输出的值。
+ 函数返回值：返回写入字符串的字符数（不包括终止的空字符）。错误输出负数

5. snprintf：格式化输出到字符串，指定最大长度。
+ 函数功能：格式化输出到字符串，指定最大长度。
+ 函数原型：
    ```c
    #include <stdio.h>
    int snprintf(char *str, size_t size, const char *format, ...);
    ```
+ 函数参数：
  + char *str：目标字符串缓冲区。
  + size_t size：缓冲区的最大长度。
  + const char *format：格式控制字符串，包含文本和格式说明符。
  + ...：可变参数列表，包含要输出的值。
+ 函数返回值：返回写入字符串的字符数（不包括终止的空字符）。如果返回值大于或等于 size，则表示输出被截断。

6. scanf：格式化输入从标准输入
+ 函数功能：格式化输入从标准输入。
+ 函数原型：
    ```c
    #include <stdio.h>
    int scanf(const char *format, ...);
    ```
+ 函数参数：
  + const char *format：格式控制字符串，包含格式说明符。
  + ...：可变参数列表，包含要存储输入值的指针。
+ 函数返回值：返回成功读取并赋值的项数。如果遇到输入错误或到达文件末尾，则返回负值。
+ 这个函数在Windows上不能使用，需要使用 scanf_s

7. sscanf：格式化输入从字符串。
+ 函数功能：格式化输入从指定文件流。
+ 函数原型：
    ```c
    #include <stdio.h>
    int sscanf(const char *str, const char *format, ...);
    ```
+ 函数参数：
  + const char *str：源字符串。
  + const char *format：格式控制字符串，包含格式说明符。
  + ...：可变参数列表，包含要存储输入值的指针。
函数返回值：返回成功读取并赋值的项数。如果遇到输入错误，则返回负值。

## 3. 字符串流 (String Streams) 函数接口

字符串流函数用于在字符串中进行格式化输入和输出操作。以下是常用的字符串流函数及其详细说明，包括函数原型、功能、参数和返回值。

1. sprintf 格式化输出到字符串。
+ 函数功能：格式化输出到字符串。
+ 函数原型：
    ```c
    #include <stdio.h>
    int sprintf(char *str, const char *format, ...);
    ```
+ 函数参数：
  + char *str：目标字符串缓冲区。
  + const char *format：格式控制字符串，包含文本和格式说明符。
  + ...：可变参数列表，包含要输出的值。
+ 函数返回值：返回写入字符串的字符数（不包括终止的空字符）。如果返回值大于或等于 size，则表示输出被截断。

2. snprintf 格式化输出到字符串，指定最大长度。
+ 函数功能：格式化输出到字符串，指定最大长度。
+ 函数原型：
    ```c
    #include <stdio.h>
    int snprintf(char *str, size_t size, const char *format, ...);
    ```
+ 函数参数：
  + char *str：目标字符串缓冲区。
  + size_t size：缓冲区的最大长度。
  + const char *format：格式控制字符串，包含文本和格式说明符。
  + ...：可变参数列表，包含要输出的值
+ 函数返回值：返回写入字符串的字符数（不包括终止的空字符）。如果返回值大于或等于 size，则表示输出被截断。

3. sscanf 格式化输入从字符串。
+ 函数功能：格式化输入从字符串。
+ 函数原型：
    ```c
    #include <stdio.h>
    int sscanf(const char *str, const char *format, ...);
    ```
+ 函数参数：
  + const char *str：源字符串。
  + const char *format：格式控制字符串，包含格式说明符。
  + ...：可变参数列表，包含要存储输入值的指针。
+ 函数返回值：返回成功读取并赋值的项数。如果遇到输入错误，则返回负值。

## 4. 其他补充知识点

### 常用格式说明符
%d：以十进制格式输出整数。
%i：以十进制格式输出整数（与 %d 相同）。
%u：以十进制格式输出无符号整数。
%f：以浮点数格式输出。
%e：以科学计数法格式输出浮点数。
%g：以最简格式输出浮点数（自动选择 %f 或 %e）。
%x：以十六进制格式输出无符号整数（小写字母）。
%X：以十六进制格式输出无符号整数（大写字母）。
%o：以八进制格式输出无符号整数。
%s：输出字符串。
%c：输出单个字符。
%p：输出指针的值。
%%：输出一个百分号字符。

### 转义字符
转义字符用于表示一些特殊的字符或控制字符，通常以反斜杠 \ 开头。以下是常见的转义字符：

\n：换行符
\t：水平制表符（Tab）
\r：回车符
\b：退格符
\f：换页符
\a：响铃符
\v：垂直制表符
\\：反斜杠
\'：单引号
\"：双引号
\?：问号
\0：空字符（NUL）

### 缓冲区是什么？

缓冲区是内存中的一块区域，用于暂存数据，以提高 I/O 操作的效率。缓冲区的使用可以减少实际 I/O 操作的次数，从而提高性能。

缓冲区的类型
+ 全缓冲（Fully Buffered）：
    数据会被暂存在缓冲区中，直到缓冲区满或显式刷新（如调用 fflush）时才会实际输出。
    例如：文件流（FILE *）通常是全缓冲的。

+ 行缓冲（Line Buffered）：
    数据会被暂存在缓冲区中，直到遇到换行符或缓冲区满时才会实际输出。
    例如：标准输出（stdout）在连接到终端时通常是行缓冲的。

+ 无缓冲（Unbuffered）：
数据不会被暂存，会立即输出。
例如：标准错误流（stderr）通常是无缓冲的。
