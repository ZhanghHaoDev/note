### 编译器构造对象文件

编译器为每个翻译单元（每个`.cpp`文件）生成一个目标文件，这些文件包含以下部分：

- **ELF头**：包含操作系统、文件类型、架构等信息。
- **节头表**：包含文件中各部分的信息，如名称、类型、位置等。
- **.text区段**：包含机器代码。
- **.data区段**：包含初始化的全局和静态变量。
- **.bss区段**：包含未初始化的全局和静态变量。
- **.rodata区段**：包含只读数据。
- **.strtab区段**：包含字符串表。
- **.shstrtab区段**：包含节名称的字符串表。

### 构建不同类型的库

- **静态库**：在UNIX系统上后缀为`.a`，在Windows上后缀为`.lib`。
- **动态库**：在UNIX系统上后缀为`.so`，在Windows上后缀为`.dll`。
- **模块库**：用于运行时加载的插件，使用`MODULE`关键字构建。

#### 构建静态库
```cmake
add_library(<name> STATIC [source..])
```

#### 构建动态库
```cmake
add_library(<name> SHARED [source..])
```

#### 构建模块库
```cmake
add_library(<name> MODULE [source..])
```

### 管理依赖

#### 查找已安装的软件包
```cmake
find_package(<PackageName> [MODULE] [REQUIRED] [COMPONENTS components...] [CONFIG] [HINTS path...] [PATHS path...] [NO_DEFAULT_PATH])
```

#### 示例：使用Protobuf
```cmake
cmake_minimum_required(VERSION 3.25)
project(class04)

find_package(Protobuf REQUIRED)
protobuf_generate_cpp(GENERATED_SRC GENERATED_HEADER message.proto)

set(CMAKE_CXX_STANDARD 17)

add_executable(class04 main.cpp ${GENERATED_SRC})
target_link_libraries(class04 PRIVATE ${Protobuf_LIBRARIES})
target_include_directories(class04 PRIVATE
    ${Protobuf_INCLUDE_DIRS}
    ${CMAKE_CURRENT_BINARY_DIR}
)
```

### 使用GIT存储库

使用`git submodule`来包含其他Git存储库：

```shell
git submodule add <url>
git submodule update --init -- <local-path-to-submodule>
```

### 使用ExternalProject和FetchContent模块

#### 使用ExternalProject
```cmake
include(ExternalProject)
ExternalProject_Add(<name>
    [SOURCE_DIR <path-to-source>]
    [BINARY_DIR <path-to-binary>]
    [CONFIGURE_COMMAND <command>]
    [BUILD_COMMAND <command>]
    [INSTALL_COMMAND <command>]
    [TEST_COMMAND <command>]
)
```

#### 使用FetchContent
```cmake
include(FetchContent)
FetchContent_Declare(
    <name>
    [URL <url>]
    [SOURCE_DIR <source-dir>]
    [BINARY_DIR <binary-dir>]
    [UPDATE_COMMAND <command>]
    [CONFIGURE_COMMAND <command>]
    [BUILD_COMMAND <command>]
    [INSTALL_COMMAND <command>]
    [TEST_COMMAND <command>]
)
FetchContent_MakeAvailable(<name>)
```

### 使用包管理器

#### 使用vcpkg
```shell
vcpkg install <package-name>[:<triplet>]
```

在CMake中使用vcpkg：
```cmake
-DCMAKE_TOOLCHAIN_FILE=[vcpkg root]/scripts/buildsystems/vcpkg.cmake
```

### 总结
- 构建不同类型的库时，选择合适的库类型和构建命令。
- 使用`find_package`、`protobuf_generate_cpp`等命令管理依赖。
- 使用`git submodule`、`ExternalProject`和`FetchContent`模块管理外部代码。
- 使用包管理器如vcpkg来简化依赖管理。
